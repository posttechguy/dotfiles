# ZSH Aliases
SITES_DIRECTORY="/Volumes/T7/Containers/www"

source ~/dotfiles/zsh/.zsh_lagoon

build_fmenu() {
  local title="$1"

  LSSHMENU=(
    fzf
    --header="$title"
    --layout=reverse
    --exact
    --border=bold
    --border=rounded
    --multi
    --color=dark
    --height=70%
    --info=hidden
    --header-first
    --bind change:top
    --prompt
  )
}

cprint() {
  local colour="$1"
  shift
  local code
  case $colour in
    red) code=31 ;;
    green) code=32 ;;
    yellow) code=33 ;;
    blue) code=34 ;;
    magenta) code=35 ;;
    cyan) code=36 ;;
    white) code=37 ;;
    bold-red)    codes="1;31" ;;
    bold-green)  codes="1;32" ;;
    on-blue)     codes="44;37" ;;   # white text on blue bg
    bold_on_red) codes="1;37;41" ;; # bold white on red
    *)           codes="0" ;;       # default/reset
  esac
  echo "\033[${code}m$*\033[0m"
}

alias please='sudo'
alias screenshots='defaults write com.apple.screencapture location ~/Screenshots/'
alias flushdns='sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder'
alias v='nvim'
alias ebash='nvim ~/.zsh_aliases'
alias rebash='source ~/.zshrc '
alias mbash='more ~/.zshrc'
alias dot='cd ~/dotfiles'
alias evim='nvim ~/.vimrc'
alias python='python3'
alias rsync='/usr/local/bin/rsync'
alias hist='history'
alias aliases='alias | grep $1'
alias lnado='lando'
alias dumps='/Users/$USER/Dumps && ll'
alias CodeDir=' ~/Code && ll'
alias office='/Users/$USER/Code/office-task-delegator'
alias Sites='~/Sites/ && ll'
alias Devkits='~/Devkits/ && ll'
alias clients='~/Documents/clients'
alias sublpackages='subl /Users/$USER/Library/Application\ Support/Sublime\ Text\ 3/Packages/Paste\ Without\ NewLines'
alias sshconfig='subl /Users/$USER/.ssh/config'
alias sshknown='subl /Users/$USER/.ssh/known_hosts'
alias hosts='subl /etc/hosts'
alias phps='/Applications/PhpStorm.app/Contents/MacOS/phpstorm'
alias asdasdasdasd='sed '1,$1d' $2 > $3'
alias cl='while [ 1 ] ; do echo -en "$(date +%T)\r" ; sleep 1; done';
alias webprint='cupsctl WebInterface=yes'
alias phpstorm='open -na "PhpStorm.app"'
alias rmddirs='rm -rf modules profiles sites themes'
alias findd='find . -type d -name $1'
alias eject='diskutil unmount  disk2s1'
alias c='codium'
alias cli='/Users/$USER/Clients'
alias sdbash='cd ~/dotfiles/sd && codium .'
alias only='open -a "ONLYOFFICE" $1'
alias cursorcache='cd ~/Library/Application\ Support/Cursor/User/workspaceStorage && rm -rf * && cd -'

function validcertfunc() {
  echo | openssl s_client -showcerts -servername $1 -connect $1:443 2>/dev/null | openssl x509 -inform pem -noout -text | grep 'Not After' | sed -e 's/^.*:\ //g'
}
alias  validcert=validcertfunc



function showtimefunc() {

  fd=$(date +%Y-%m-%d); # 2019-06-28
  md=$(date +%m-%B);    # 06-June
  yd=$(date +%Y);       # 2019
  #wd=$(date +%U);       # W15
  wd=$((10#$(date +%U) + 1))

  history_root="/Users/${USER}/Documents/History";
  LOG_FILE="/Users/${USER}/Timesheets/${yd}/${md}/Jira-Import-W${wd}-${fd}.csv";
  ruddr=$(awk -F',' '{ ruddr += $3 } END { print ruddr }' ${history_root}/ruddr.md)
  ruddr_printed=$(echo "scale=2; $ruddr" | bc)
  sum=$(awk -F',' 'NR > 1 { sum += $3 } END { print sum }' ${LOG_FILE})
  sum_printed=$(echo "scale=2; $sum" | bc)
  saved_time=$(echo "scale=2; ${ruddr_printed} + ${sum_printed}" | bc)
  echo   "|------------------|------|"
  printf "| Saved time:      | %.2f |\n" "$saved_time"
  printf "| Ruddr:           | %.2f |\n" "$ruddr_printed"
  catchup_time=$(echo "scale=2; 7.60 - ${ruddr_printed} - ${sum_printed}" | bc)
  cprint red "|------------------|------|"
  printf "| Time to catchup: | %.2f |\n" "$catchup_time"
  echo   "|------------------|------|"
}
alias  showtime=showtimefunc

function ruddrfunc() {

  dd=$(date +%a);
  history_root="/Users/${USER}/Documents/History";
  ruddr=$(awk -F',' '{ ruddr += $3 } END { print ruddr }' ${history_root}/ruddr-${dd}.md)
  ruddr_printed=$(echo "scale=2; $ruddr" | bc)
  echo   "|------------------|------|"
  printf "| Ruddr:           | %.2f |\n" "$ruddr_printed"
  echo   "|------------------|------|"
}
alias  ruddr=ruddrfunc

function thisweekfunc() {

  sum_total=0
  ruddr_total=0

  history_root="/Users/${USER}/Documents/History";

  for i in {0..4}; do
    dd=$(date -v-mon -v+"$i"d "+%a")
    fd=$(date -v-mon -v+"$i"d "+%Y-%m-%d")
    md=$(date -v-mon -v+"$i"d "+%m-%B")
    yd=$(date -v-mon -v+"$i"d "+%Y")
    wd=$((10#$(date +%U) + 1))

   #     CURRENT_DATE=$(date -v-mon -v+"$i"d "$DATE_FORMAT")
    LOG_FILE="/Users/${USER}/Timesheets/${yd}/${md}/Jira-Import-W${wd}-${fd}.csv";

    if [[ -f "$LOG_FILE" ]]; then
      sum=$(awk -F',' 'NR > 1 { sum += $3 } END { print sum }' ${LOG_FILE})
    fi

    ruddr=$(awk -F',' '{ ruddr += $3 } END { print ruddr }' ${history_root}/ruddr-${dd}.md)

    sum_total=$(( sum_total + sum ))
    ruddr_total=$(( ruddr_total + ruddr ))

  done
  sum_printed=$(echo "scale=2; $sum_total" | bc)
  ruddr_printed=$(echo "scale=2; $ruddr_total" | bc)

  total=$(( sum_printed + ruddr_printed ))
  total_printed=$(echo "scale=2; $total" | bc)
  catchup_total=$(( 38.00 - total ))
  catchup_printed=$(echo "scale=2; $catchup_total" | bc)

  echo   "|------------------|-------|"
  printf "| Week to date:    | %.2f |\n" "$total_printed"
  echo   "|------------------|-------|"
  printf "| Catch up:        | %.2f |\n" "$catchup_printed"
  echo   "|------------------|-------|"
}
alias  thisweek=thisweekfunc


function getlogfilefunction() {

  LOG_FILE="dummy text";

  fd=$(date +%Y-%m-%d); # 2019-06-28
  md=$(date +%m-%B);    # 06-June
  yd=$(date +%Y);       # 2019
  wd=$((10#$(date +%U) + 1))

  LOG_FILE="/Users/${USER}/Timesheets/${yd}/${md}/Jira-Import-W${wd}-${fd}.csv";

  echo  "${LOG_FILE}"
}
alias getlogfile=getlogfilefunction


function hasdupfunction() {

  today_file=$(getlogfile)
  has_dup_output=$(tail -n +2 ${today_file} | grep -v '•' | cut -d',' -f1 | sort | uniq -c | sort -nr | grep -v '1 ')

   if [[ -z "$has_dup_output" ]]; then
      echo "There are no duplicate entries. Hazaar!!!!"
   else
      echo "${has_dup_output}"
   fi
}
alias hasdup=hasdupfunction

#alias lsup='cd ~/Code/scripts && git pull && ./project stop && ./project build && ./project start && ./project use'

### Docker
alias dcm='/usr/local/bin/docker-compose exec mariadb bash'
alias dpst='/usr/local/bin/docker container ls --format "table {{.ID}}\t{{.Names}}\t{{.Ports}}" -a'
alias dk="pkill -SIGHUP -f /Applications/Docker.app 'docker serve' "
alias dup="open -a Docker && sleep 15 && ps aux | grep Docker"
alias iscon='ahoy drush st | grep "Connected"'
alias dcu='/usr/local/bin/docker-compose up'
alias dcd='/usr/local/bin/docker-compose down'
alias dcr='/usr/local/bin/docker-compose run'
alias dce='/usr/local/bin/docker-compose exec'
alias dcud='/usr/local/bin/docker-compose up -d'
alias dcps='/usr/local/bin/docker-compose ps'
alias dcl='/usr/local/bin/docker-compose logs'
alias dps="/usr/local/bin/docker ps"
alias dspr="/usr/local/bin/docker system prune --all --force --volumes"
alias dpa="/usr/local/bin/docker ps -a"
alias di="/usr/local/bin/docker images"

alias top='bpytop'

function lsupfunction() {
    cd ~/Code/doghouse-lagoon-scripts &&
    lagoon login &&
    ./project full-rebuild
}
alias lsup=lsupfunction

function stupfunction() {
    ./project stop;
    pids=$(ps aux | grep "Applications\/Docker.app" | awk  '{print $2}');

    # Loop through each PID and kill it if it's valid
    for pid in $pids; do
      if kill -0 $pid 2>/dev/null; then  # Check if the PID exists
        kill $pid
      fi
    done

    return;
}
alias stup=stupfunction

alias kjb='pkill -15 jetbrains-toolbox && /Applications/JetBrains\ Toolbox.app/Contents/MacOS/jetbrains-toolbox --minimize &'
alias kps='ps aux | grep PhpStorm'

alias mon='ssh bholman@monitoring-01.stack.host'

source ~/dotfiles/zsh/.zsh_site_aliases.sh

## Commands
### Grep
alias grep='grep --color=auto '
alias ggrep='ggrep --color=auto '
alias grn='ggrep -nr --color=auto '
alias grni='ggrep -nri --color=auto '
alias grl='ggrep -rl --color=auto "$1" *'
alias fgrn='find . -type f -exec grep -nr "$1" {} \;'
alias fgrni='find . -type f -exec grep -nri "$1" {} \;'
alias grns='ggrep -nr --color=auto "$1" | ggrep scss'

### Ahoy
alias af='ahoy up'
alias ad='ahoy down'
alias aa='ahoy ant'
alias ap='ahoy phing'
alias abp='ahoy bash php'
alias abm='ahoy bash mariadb'
alias dss='/usr/local/bin/docker-sync start'
alias dsd='/usr/local/bin/docker-sync stop'
alias dex='/usr/local/bin/docker ps --filter "status=exited"'


function dddbfunction() {

  SEARCH_CONTAINER=`echo "$1"`

  docker ps --filter "status=exited" | grep "$SEARCH_CONTAINER" | awk "{print \$1}" | xargs docker rm

}

alias dddb=dddbfunction

### Lando
alias lns='lando start'
alias lna='lando poweroff'
alias lnx='lando xdebug-on'
alias lnz='lando xdebug-off'
alias ldc='lando drush cr'
alias ldu='lando drush uli'
alias lpo='lando poweroff'

alias lzd='lazydocker'

alias nst='sudo netstat -nl -p tcp | grep $1'
alias vdrush='./vendor/drush/drush/drush'

alias findfileslike='find . -name "$1" -type f'
alias deletefileslike='find . -name "$1" -type f -delete'
alias rmDStore='find . -name ".DS_Store" -depth -exec rm {} \;'
alias rmSnapshots='find . -name "*.sql.gz" -depth -exec rm {} \;'

alias magentocache='rm -rf var/cache/*'
alias exceptionlog='tail -f var/log/exception.log'
alias systemlog='tail -f var/log/system.log'

alias loadavg='sysctl -n vm.loadavg'
alias ll='eza -alg --colour=always --group-directories-first --git'
alias lll='eza -alg --colour=always --group-directories-first --git'
alias lsd='eza -aldg --colour=always */'
alias lt='ls -alt'
alias pwd='pwd -P'
alias vr='vagrant reload'
alias vs='vagrant ssh'
alias rva='rsync -avPht'
function gxfunc() {
  start=`date +%s`;
  gunzip $1;
  end=`date +%s`;
  runtime=$((end-start));
  echo "\nRuntime: $runtime seconds";
}
alias gx=gxfunc

function gzfunc() {
  start=`date +%s`;
  gzip $1;
  end=`date +%s`;
  runtime=$((end-start));
  echo "\nRuntime: $runtime seconds";
}
alias gz=gzfunc

function reportingfunc() {
  cd /Users/$USER/Documents/Reporting
  find . -type f -exec sed -i -e "s/$1/$2/g" {} \;
  rm *-e
}
alias rep=reportingfunc

alias gz='gzip'
alias untar='tar -xvf'
alias untargz='tar -xzvf'

# OG zip -er powerdiv_live.zip powerdiv_live.sql
# New zippass powerdiv_live.sql powerdiv_live.zip
alias zippass='zip -er $2 $1'


# To tar and gzip a folder, the syntax is:

# tar czf name_of_archive_file.tar.gz name_of_directory_to_tar
# Adding - before the options (czf) is optional with tar. The effect of czf is as follows:

# c — create an archive file (as opposed to extract, which is x)
# f — filename of the archive file
# z — filter archive through gzip (remove this option to create a .tar file)
# If you want to tar the current directory, use . to designate that.

# To construct filenames dynamically, use the date utility (look at its man page for the available format options). For example:

# cd /var/www &&
# tar czf ~/www_backups/$(date +%Y%m%d-%H%M%S).tar.gz .
# This will create a file named something like 20120902-185558.tar.gz.

alias staging='git fetch origin staging && git checkout staging && git reset --hard remotes/origin/staging && git pull origin staging'
alias production='git checkout production'
alias uat='git checkout uat && git pull origin uat'
alias gs='git status'
alias gb='git branch'
alias gba='git branch -a'
alias ga='git add '
alias gu='git checkout -- '
alias gcfd='git clean -f -d'
alias gd='git diff --ignore-space-at-eol -b -w '
alias gti='git'
alias gri='git rebase -i HEAD~2'
alias lg='lazygit'
alias grpo='git remote prune origin'

alias hastwigtweak='find web/{modules/custom,themes} -name "*.twig" -exec grep -l drupal_ {} \; -exec grep drupal_ {} \;'

function mvgxfunction() {

  NAME=`echo "$1" | cut -d'.' -f1`
  EXTENSION=`echo "$1" | cut -d'.' -f2`

  mv $1 . && gunzip "$NAME.$EXTENSION"
}
alias mvgx=mvgxfunction

FASTLY_KEY="bwttvSgpGieZvsfYijCj1LtLFGzTI0D_"

# Usage :
# Staging sites need the basic auth added
# $ purgeurl https://afp-missing-persons-districtcms:afp-missing-persons-districtcms@staging.afp-missing-persons-districtcms.doghouse.cloud
# Production sites are just the URL
# $ purgeurl https://www.rdrv.vic.gov.au/

function purgeurlfunction() {

  curl -XPURGE -H Fastly-Key:$FASTLY_KEY $1

}
alias purgeurl=purgeurlfunction

# Staging sites need the basic auth added
# $ purgedomain staging.afp-missing-persons-districtcms.doghouse.cloud afp-missing-persons-districtcms:afp-missing-persons-districtcms
# Production sites are just the URL
# $ purgedomain www.rdrv.vic.gov.au

function purgedomainfunction() {

  basic_auth=""
  if [ "$2" != "" ]; then
    basic_auth="$2@"
  fi

  echo "curl -sXPOST https://api.fastly.com/service/0VfjtEv26MEnPZwvF4qtZO/purge/$basic_auth$1 -H \"Fastly-Key:$FASTLY_KEY\""
  curl -sXPOST https://api.fastly.com/service/0VfjtEv26MEnPZwvF4qtZO/purge/$basic_auth$1 -H "Fastly-Key:$FASTLY_KEY"

}
alias purgedomain=purgedomainfunction

function cachedomainfunction() {

  # basic_auth=""
  # if [ "$2" != "" ]; then
  #   basic_auth="$2@"
  # fi

  echo "curl -sLIXGET -H 'Fastly-Debug: 1' -H 'Accept-Encoding: br, zstd, gzip, deflate' \"$1\" | sort"
  curl -sLIXGET -H 'Fastly-Debug: 1' -H 'Accept-Encoding: br, zstd, gzip, deflate' "$1" | sort

}
alias cached=cachedomainfunction


function fixpermfunction {
    find . -type f -exec chmod 644 {} \;
    find . -type d -exec chmod 755 {} \;
}
alias fixperm=fixpermfunction

function syncmasterbranchfunction() {

  # Cycle through branch names until one is found
  for branch in "live" "master" "production" "main" "staging"; do
    exists=`git show-ref refs/heads/$branch`

    if [ -n "$exists" ]; then
      BRANCHIMON=`git symbolic-ref --short -q HEAD`

      if [ "$BRANCHIMON" != "$branch" ]; then
        git fetch origin $branch
        git checkout $branch
      fi
      if [ "$1" = "HEAD" ]; then
        git reset --hard remotes/origin/$branch
      fi
      git pull origin $branch;
      break;
    fi
  done
}
alias main=syncmasterbranchfunction

function getbranchfunction() {
  git fetch origin $1
  git checkout $1
  git reset --hard remotes/origin/$1
  git pull origin $1;
}
alias getb=getbranchfunction

function cleangitfunction() {
  find . -name "*.orig" -exec rm {} \;
  find . -name "*.rej" -exec rm {} \;
}
alias cleangit=cleangitfunction

alias lush='php artisan '
alias valeterror='tail -f /Users/$USER/.config/valet/Log/nginx-error.log'
# alias valetnginxconf='vim /usr/local/etc/nginx/nginx.conf'

function llogfunction() {
  dd=$(date -v -0d '+%d');
  md=$(date -v -0d '+%m');
  yd=$(date -v -0d '+%Y');

  tail -f storage/logs/laravel-"$yd"-"$md"-"$dd".log
}
alias llog=llogfunction

function routelistfunction {
  php artisan route:list | grep -E '\\$1|-|Action'
}
alias routelist=routelistfunction

function washsqlfunction {
    sed -i -e 's/https://www\.$1\.com\.au/http://www\.$1\.com\.au/g' /Users/$USER/dumps/$2
    sed -i -e 's/https://$1\.com\.au/http://www\.$1\.com\.au/g' /Users/$USER/dumps/$2
    sed -i -e 's/www\.$1\.com\.au/$1\.dhbox\.dev/g' /Users/$USER/dumps/$2
    sed -i -e 's/$1\.com\.au/$1\.dhbox\.dev/g' /Users/$USER/dumps/$2
}
alias washsql=washsqlfunction

function awskeysfunction() {
    openssl genrsa 2048 >  ~/.ssh/$1.pem
    sudo chmod 400  ~/.ssh/$1.pem
}
alias awskeys=awskeysfunction

export PHP_IDE_CONFIG="serverName=test"
export XDEBUG_CONFIG="remote_enable=1 remote_mode=req remote_port=9000 remote_host=127.0.0.1 remote_connect_back=0"

#find . -type f -mtime +45 -name '*.sql' -execdir rm -- {} \;

function rmallfilesolderthanfunction {
find . -type f -mtime +$2 -name '$1' -execdir rm -- {} \;
}
alias rmallfilesolderthan=rmallfilesolderthanfunction

alias googledict='subl /Users/$USER/Library/Spelling/LocalDictionary'

#cp -R ../benara.old/media/ media/

#if [ -f $(brew --prefix)/etc/bash_completion ]; then
#. $(brew --prefix)/etc/bash_completion
#fi

alias nopasslogin='ssh-copy-id -i ~/.ssh/id_rsa.pub $1 $2'

function mkcdirfunction ()
{
    mkdir -p -- "$1" &&
      cd -P -- "$1"
}
alias mkcdir=mkcdirfunction

function inittimefunction() {

  fd=$(date +%Y-%m-%d); # 2019-06-28
  md=$(date +%m-%B);    # 06-June
  yd=$(date +%Y);       # 2019
  #wd=$(date +%U);       # W15
  wd=$((10#$(date +%U) + 1))

  history_root="/Users/${USER}/Documents/History";
  templatefile="${history_root}/default.log";
  mdfile="${history_root}/${yd}/${md}/${fd}.md";

  mkdir -p "${history_root}/${yd}/${md}";

  # this_day=$(date -v-mon -v+"$1"d "+%a")

  # if [ "${this_day}" = "Mon" ]; then
  #   for i in {0..4}; do
  #     dd=$(date -v-mon -v+"$i"d "+%a")
  #     touch "${history_root}/ruddr-${dd}.md";
  #     cat "${history_root}/ruddr-init.md" > "${history_root}/ruddr-${dd}.md";
  #   done
  # fi

  if [ ! -f "${mdfile}" ]; then
      touch "${mdfile}";
      chmod 777 "${mdfile}";
      cat "$templatefile" > "$mdfile";
      current_date=$(date "+%Y-%b-%d")
      current_day=$(date "+%A")
      week_number=$(date +%U)
      week_number=$((week_number + 1))
      formatted_week=$(printf "%02d" $week_number)
      sed -i '' "s/yyyy-mmm-dd/$current_date/g" "$mdfile"
      sed -i '' "s/ddd/$current_day/g" "$mdfile"
      sed -i '' "s/www/$formatted_week/g" "$mdfile"

      # touch "${history_root}/ruddr-${dd}.md";
      # cat "${history_root}/ruddr.md" > "${history_root}/ruddr-${dd}.md";

  fi
  MD_FILE="${mdfile}"

  timesheet_root="/Users/${USER}/Timesheets";
  templatefile="${history_root}/timesheet.csv";
  logfile="${timesheet_root}/${yd}/${md}/Jira-Import-W${wd}-${fd}.csv";

  mkdir -p "${timesheet_root}/${yd}/${md}";

  if [ ! -f "${logfile}" ]; then
      touch "${logfile}";
      chmod 777 "${logfile}";
      cat "$templatefile" > "$logfile";
  fi
  LOG_FILE="${logfile}"  # ✅ This is how we return a value without a subshell

  # echo "MD_FILE: $MD_FILE"
  # echo "---------------------------------------------------------------------------------------------------------------"
  # echo "LOGFILE: $logfile"
  # echo "---------------------------------------------------------------------------------------------------------------"

  cprint blue "---------------------------------------------------------------------------------------------------------------"
  # time_elpased=$(howlong)
  # howlong_since=$(echo "$time_elpased" | grep -oE '[0-9]+(\.[0-9]+)?' | tail -n 1)
  echo "Ruddr file: ${history_root}/ruddr.md"
  ruddr=$(awk -F',' '{ ruddr += $3 } END { print ruddr }' ${history_root}/ruddr.md)
  ruddr_printed=$(echo "scale=2; $ruddr" | bc)

  sum=$(awk -F',' 'NR > 1 { sum += $3 } END { print sum }' ${LOG_FILE})
  echo "${sum}"
  sum_printed=$(echo "scale=2; $sum" | bc)
  saved_time=$(echo "scale=2; ${ruddr_printed} + ${sum_printed}" | bc)
  printf "Saved time:  %.2f\n" "$saved_time"
  printf "Ruddr:  %.2f\n" "$ruddr_printed"
  cprint blue "---------------------------------------------------------------------------------------------------------------"

  catchup_time=$(echo "scale=2; 7.60 - ${ruddr_printed} - ${sum_printed}" | bc)
  cprint bold_on_red ""
  printf "${red}Time to catchup: ${yellow}%.2f${reset}\n" "$catchup_time"
  cprint red "---------------------------------------------------------------------------------------------------------------\n\n"

}
alias inittime=inittimefunction

function gethistoryfunction() {
    DAY_INTERVAL="$1d";
echo $DAY_INTERVAL;
echo "$(date -v -$DAY_INTERVAL +%A)"
echo "$(date -v -$DAY_INTERVAL +%u)"

    if [[ $(date -v -$DAY_INTERVAL +%A) -eq 'Sunday' ]]; then
      DAY_INTERVAL="3d";
    fi
echo $DAY_INTERVAL;

    # dd=$(date -v -$DAY_INTERVAL +%d/%m/%Y); # 10/31/2019
    # fd=$(date -v -$DAY_INTERVAL +%Y-%m-%d); # 2019-06-28
    # md=$(date -v -$DAY_INTERVAL +%m-%B);    # 06-June
    # yd=$(date -v -$DAY_INTERVAL +%Y);       # 2019
    # history_root="/Users/$USER/Documents/History";
    # logfile="$history_root/$yd/$md/$fd.csv";

    # if [ ! -d "$history_root/$yd/$md" ]; then
    #     mkdir -p "$history_root/$yd/$md";
    # fi

    # if [ ! -f "$logfile" ]; then
    #     touch "$logfile";
    #     chmod 777 "$logfile";
    # fi

    # echo $dd;
    # echo $logfile;

    # history -E | sort -k3,3 -k2 | grep "22.9.2025" >> /Users/$USER/Documents/History/2025/09-Sepetember/2025-09-22.md
    # history -E | sort -k3,3 -k2 | grep "$dd" >> "$logfile";
}
alias gethist=gethistoryfunction

alias day='inittime 0'
alias std='inittime 0 && gethist 1'
alias etd='gethist 0'

function ddifunction() {

    for i in $(docker images -q)
    do
        docker history $i | grep -q $1 && echo $i
    done | sort -u
}
alias ddi=ddifunction

# Setting PATH for Python 3.7
# The original version is saved in .bash_profile.pysave
PATH="/Library/Frameworks/Python.framework/Versions/3.7/bin:${PATH}"
export PATH

# Setting PATH for Python 3.7
# The original version is saved in .bash_profile.pysave
PATH="/Library/Frameworks/Python.framework/Versions/3.7/bin:${PATH}"
export PATH

#[ -f /usr/local/etc/bash_completion ] && . /usr/local/etc/bash_completion || {
    # if not found in /usr/local/etc, try the brew --prefix location
  #  [ -f "$(brew --prefix)/etc/bash_completion.d/git-completion.bash" ] && \
   #     . $(brew --prefix)/etc/bash_completion.d/git-completion.bash
#}

alias wifipassword='security find-generic-password -ga "doghouse" |grep "password:"'

# BEGIN SNIPPET: Platform.sh CLI configuration
HOME=${HOME:-'/Users/$USER'}
export PATH="$HOME/"'.platformsh/bin':"$PATH"
if [ -f "$HOME/"'.platformsh/shell-config.rc' ]; then . "$HOME/"'.platformsh/shell-config.rc'; fi # END SNIPPET
export PATH="/usr/local/opt/php/bin:$PATH"
export PATH="/usr/local/opt/php/sbin:$PATH"

function sphp72function() {
    sphpstop
    brew services start php@7.2
    brew link php72
    export PATH="/usr/local/opt/php@7.2/bin:$PATH"
    export PATH="/usr/local/opt/php@7.2/sbin:$PATH"
}
alias sphp72=sphp72function

function sphp73function() {
    sphpstop
    brew services start php@7.3
    brew link php73
    export PATH="/usr/local/opt/php@7.3/bin:$PATH"
    export PATH="/usr/local/opt/php@7.3/sbin:$PATH"
}
alias sphp73=sphp72function

alias mdb='mysql -uroot'

function getlagoonenvironment() {

  shortEnv="$1";
  delimiter="$2";
  lagoon="deploy${delimiter}lagoon";
  project=;
  enviro="${lagoon}${delimiter}staging";

  if [ "$shortEnv" = "production" ]
  then
    enviro="${lagoon}${delimiter}production";
  fi
  if [ "$shortEnv" = "staging" ]
  then
    enviro="${lagoon}${delimiter}staging";
  fi
  if [ "$shortEnv" = "development" ]
  then
    enviro="${lagoon}${delimiter}development";
  fi

  echo "$enviro";
}
alias gle=getlagoonenvironment

function lagoonsshfunction() {

  #build_fmenu "Lagoon SSH — Choose a client: "
  #lagoon_client=$(printf "%s\n" "${lagoon_clients[@]}" | "${LSSHMENU[@]}")

  lagoon_client=`printf "${lagoon_clients}" | fzf`
  lagoon_env=`printf "${lagoon_envs}" | fzf`

  environment=$(getlagoonenvironment "${lagoon_env}" "/")
  display_env=$(getlagoonenvironment "${lagoon_env}" "-")

  if [[ -n "${lagoon_projects['$lagoon_client']}" ]]; then
    date
    echo "Connecting to lagoon: ${lagoon_projects['$lagoon_client']}-${display_env}"
    echo "lagoon ssh --project ${lagoon_projects['$lagoon_client']} --environment ${environment}"
    echo "Drush: ./vendor/drush/drush/drush uli"
    lagoon ssh --project $lagoon_projects['$lagoon_client'] --environment $environment && return;
  else
    echo "Bah boouw"
  fi
}
alias lssh=lagoonsshfunction


function lagoonulifunction() {

  uid="$3";
  drush_command="drush uli"

  lagoon_client=`printf "${lagoon_clients}" | fzf`
  lagoon_env=`printf "${lagoon_envs}" | fzf`

  environment=$(getlagoonenvironment "${lagoon_env}" "/")
  display_env=$(getlagoonenvironment "${lagoon_env}" "-")

  if [[ -n "${lagoon_projects['$1']}" ]]; then
    date
    echo "Connecting to lagoon: ${$lagoon_projects['$lagoon_client']}-${environment}"
    echo "lagoon ssh -p ${$lagoon_projects['$lagoon_client']} -e ${environment} -C $drush_command"

    # if [ -n "$3" ]; then
    #     drush_command="drush uli --uid=${uid}"
    # fi
    lagoon ssh -p $lagoon_projects['$lagoon_client'] -e $environment -C $drush_command
  else
    echo "Bah boouw"
  fi
}
alias luli=lagoonulifunction

function lagoonstfunction() {

  environment=$(getlagoonenvironment "$2" "-")

  if [[ -n "${lagoon_projects['$1']}" ]]; then
    echo "Connecting to lagoon: ${lagoon_projects['$1']}-${environment}"

    lagoon ssh -p $lagoon_projects['$1'] -e $environment -C "drush status"
  else
    echo "Bah boouw"
  fi
}
alias lst=lagoonstfunction


getent() {
  [ "$1" = "hosts" ] && shift
  for x
  do
    echo $x $(dscacheutil -q host -a name $x | awk '/^ip_address/{print $NF}')
  done
}

function drushallfunction() {

  # drushall user-create carla.jobson --mail='carla.jobson@twocircles.com' --password='overspend retrieval unwary confidant'
  # drushall user-add-role 'administrator' --uid=<uid>

  declare -a SITES=`find ./web/sites/. -mindepth 1 -maxdepth 1 -type d -exec basename {} \;`

  # Run parsed in command
  # ie, ./scripts/drush-all cr
  # Would clear cache for all sites
  for siteslug in ${SITES}; do

    # Always skip Default as its an empty site
    if [ $siteslug == "default" ]; then
      echo "Skipping DEFAULT"
      continue
    fi

    ./vendor/drush/drush/drush -l $siteslug $*
  done
}
alias drushall=drushallfunction

function awewhiterebuildfunction() {
    ahoy stop
    docker rm awe-white_mariadb_1
    docker rm awe-white_cli_1
    docker rm awe-white_php_1
    docker rm awe-white_nginx_1
    docker rm awe-white_test_1
    ahoy refresh-db
    echo "wait a bit..."
    sleep 20
    ahoy build
    ahoy cim
    echo "here is your super special login link..."
    ahoy login
}
alias awe-whiterebuild=awewhiterebuildfunction

function latroberebuildfunction() {
    ahoy stop
    docker login gitlab-registry-production.govcms.amazee.io
    docker rm latrobe-vic_mariadb_1
    docker rm latrobe-vic_cli_1
    docker rm latrobe-vic_php_1
    docker rm latrobe-vic_nginx_1
    ahoy refresh-db
    echo "wait a bit..."
    sleep 20
    ahoy build
    ahoy cim
    echo "here is your super special login link..."
    ahoy login -- --uid=18
}
alias latroberebuild=latroberebuildfunction

function sql-councilfunction() {
    echo "Reset DB for Council...";
    cd $SITES_DIRECTORY/district/whitelabel;
    ahoy drush sql:drop;
    ahoy drush sql:sync @self.council_uat_remote @self.council_local;
    ahoy drush cr;
    ahoy drush updb;
    ahoy drush cim;
    ahoy drush cr;
    ahoy drush pmu config_devel;
    cd $SITES_DIRECTORY/district/whitelabel;
    echo "Done. Admin login:";
    ahoy drush @self.council_local uli;
}
alias sql-council=sql-councilfunction


#alias solotelsync='ahoy sync:db $1'
#alias solotellogin='platform ssh'

## compile

function compilingfunction() {
  start=`date +%s`

  if [ "$1" = "dp" ]
  then
    dp && \
    lando npm run build -- --theme=subthemes/experienceperth && \
    lando drush cr;
  fi
  if [ "$1" = "district" ]
  then
    $2 && \
    lando npm run build -- --theme=subthemes/$2 && \
    lando drush cr;
  fi
  if [ "$1" = "solotel" ]
  then
    ahoy build:css && \
    lando drush -l $2 cr;  # lando drush -l goros cr
  fi
  if [ "$1" = "vcat" ]
  then
    vcat && \
    lando npm run build && \
    lando drush cr;
  fi

  if [ "$1" = "sbdc" ]
  then
    lando npm run build -- --theme=subthemes/small_business --custom && \
    lando drush cr;
  fi
  if [ "$1" = "afp--act-policing-news" ]
  then
    lando npm run build -- --theme=docroot/sites/all/themes/afp_theme --custom && \
    lando drush cr;
  fi

  if [ "$1" = "mcc" ]
  then
    manningham && \
    lando npm run build -- --theme=subthemes/manningham --custom && \
    lando drush cr;
  fi
  if [ "$1" = "vdwc" ]
  then
   npm run build && \
   ahoy drush cr;
  fi

  if [ "$1" = "nhpo" ]
  then
   cd ~/Sites/docker/govcms/nhpo/themes/custom/nhpo && \
   npm install && \
   npm run build && \
   nhpo
   ahoy drush cr;
  fi

  if [ "$1" = "laundy" ]
  then
    lando npm run build
    lando drush -l $2 cr;
  fi

  if [ "$1" = "gosnells" ]
  then
    lando build
    lando drush cr;
  fi

  end=`date +%s`

  runtime=$((end-start))

  echo "\nRuntime: $runtime seconds";
}
alias compile=compilingfunction

function iminfunction() {
  WHEREAMI=$(pwd | sed 's#.*/##')

  if [ $WHEREAMI = "mhfa" ] || [ $WHEREAMI = "wheatbelt" ] || [ $WHEREAMI = "solotel" ]
  then
    lando start
  fi
  if [ $WHEREAMI = "nhpo" ]
  then
    pygmy up && ahoy up
  fi
}
alias imin=iminfunction

function imoutfunction() {
  WHEREAMI=$(pwd | sed 's#.*/##')

  if [ $WHEREAMI = "mhfa" ] || [ $WHEREAMI = "wheatbelt" ] || [ $WHEREAMI = "solotel" ]
  then
    lando poweroff
    docker ps
  fi
  if [ $WHEREAMI = "nhpo" ]
  then
    ahoy stop && pygmy stop
    docker ps
  fi
}
alias imout=imoutfunction

# dbimport
function dbimportfunction() {
  start=`date +%s`

  if [ "$1" = "laundy" ]
  then
    lando db-import -h mariadb-$2 $3 && \
    lando drush cr;
  fi

  if [ "$1" = "solotel" ]
  then
    lando db-import -l $2 $3 && \
    lando drush cr;
  fi

  if [ "$1" = "mhfa" ]
  then
    lando db-import $2 && \
    lando drush dis memcache -y
    lando drush cc all;
  fi

  end=`date +%s`

  runtime=$((end-start))

  echo "\nRuntime: $runtime seconds";
}
alias dbimport=dbimportfunction

function districtcompilefunction() {
    $1 && lando npm run build -- --theme=subthemes/$1;
}
alias dist=districtcompilefunction

function updatingfunction() {
    if [ "$1" = "doghouseconsole" ]
    then
        composer global update doghouse-agency/console
    fi
    if [ "$1" = "npm" ]
    then
        sudo npm install -g npm
    fi
    if [ "$1" = "drupal" ]
    then
        error="InvalidArgumentException"
        recommended=`composer show drupal/core-recommended 2&>1`

        if [[ $recommended =~ $error ]];
        then
          echo 'recommended';
          COMPOSER_MEMORY_LIMIT=-1 composer1 update drupal/core 'drupal-core-*' --with-all-dependencies
        else
          echo 'core';
          COMPOSER_MEMORY_LIMIT=-1 composer1 update drupal/core --with-dependencies
        fi

    fi
    if [ "$1" = "valet" ]
    then
        composer global require laravel/valet
    fi
    if [ "$1" = "laravel" ]
    then
        composer global require laravel/installer
    fi

}
alias update=updatingfunction

function vmfunction() {

    if [ "$1" = "valet" ]
    then
      cd $SITES_DIRECTORY/laravel;

      valet $2;
    fi
    if [ "$1" = "mailhog" ]
    then
      brew services $2 mailhog;
    fi
}
alias vm=vmfunction

function tarthisfunction() {
    tar cvf $1.tar $1 && gzip $1.tar
}
alias tarthis=tarthisfunction

function webifyimagefunction() {
  convert $1 -quality 80 $1
}
alias webifyimage=webifyimagefunction
function changespacesfunction() {
    for i in *;do mv "$i" "${i// /_}";done
}
alias changespaces=changespacesfunction

function isgitrepofunction() {
    if [ -d .git ]; then
      pwd
    #  git remote -v
    else
      git rev-parse --git-dir 2> /dev/null;
    fi;
}
alias isgitrepo=isgitrepofunction

function findrepofunction() {
    find . -maxdepth 1 -type d \( ! -name . \) \-exec zsh -c "cd '{}' && isgitrepo | grep $1" \;
}
alias findrepo=findrepofunction

function closefunction() {
    gethist 0 && exit;
}
alias close=closefunction

#eval "$(rbenv init -)"
#export PATH="/usr/local/mysql/bin:$HOME/.rbenv/bin:$PATH"

export NVM_DIR=~/.nvm
#source $(brew --prefix nvm)/nvm.sh

alias getkey='pbcopy < ~/.ssh/id_rsa.pub'
alias addkey='ssh-add -K ~/.ssh/id_rsa'

function getimagesfunction() {
    find "$HOME" -type f -name '*.jpg' \
      -exec sh -c 'for d; do dirname "$d"; done' sh {} + | sort -u -o jpeg_dirs.txt


   #   find "$HOME" -type f -name '*.jpg' -printf '%h\n' | sort -u -o jpeg_dirs.txt


    find . -type f -iname '*.jpg' | while read file; do
        ts=$(stat -f '%Sm' -t '%Y-%m-%d' "$file")
        folder="/path/to/backup/folder/$ts"
        [[ -d "$folder" ]] || echo mkdir "$folder"
        echo mv "$file" "$folder/"
    done
}
alias getimages=getimagesfunction

function chnagephpfunction() {

    php_version=`php -v | tail -r | tail -n 1 | cut -d " " -f 2 | cut -c 1-3`

echo $php_version;
    brew unlink php@$php_version
    brew link php@$1
    export PATH="/usr/local/opt/php@$1/bin:$PATH"
    export PATH="/usr/local/opt/php@$1/sbin:$PATH"
}
alias chnagephp=chnagephpfunction
alias changephp=chnagephpfunction


function clearmaccachefunction() {
  composer clearcache;
  npm -global cache clean --force;
  sudo rm -rf ~/Library/Caches/*;
  docker system prune;
}
alias clearmaccache=clearmaccachefunction

function searchandreplacefunction() {
  find . \( -type d -name .git -prune \) -o -type f -print0 | xargs -0 sed -i 's/$1/$2/g'
}
alias searchandreplace=searchandreplacefunction

function pngtosvgfunction () {
  convert -alpha remove $1.png pgm: | mkbitmap -f 32 -t 0.4 - -o - | potrace --svg -o $1.svg
}
alias pngtosvg=pngtosvgfunction

alias png2svg='png2svg-cli'

#brew link --force --overwrite php@7.4
#brew services start php@7.4

# export PATH="/usr/local/opt/php@7.4/bin:$PATH"
# export PATH="/usr/local/opt/php@7.4/sbin:$PATH"

#brew link --force --overwrite php@8.1
# export PATH="/usr/local/opt/php@8.4/bin:$PATH"
# export PATH="/usr/local/opt/php@8.4/Sbin:$PATH"
export PATH="/opt/homebrew/opt/php@8.3/bin:$PATH"
export PATH="/opt/homebrew/opt/php@8.3/sbin:$PATH"

# brew link --force --overwrite php@8.2
# brew services start php@8.2
export PATH="/usr/local/opt/php/bin:$PATH"
export PATH="/usr/local/opt/php/sbin:$PATH"
export PATH="/Users/$USER/dotfiles/sd/usr/local/bin:$PATH"
export PATH="/Applications/VSCodium.app/Contents/Resources/app/bin:$PATH"

# sudo ln -s "/Applications/Sublime Text.app/Contents/SharedSupport/bin/subl" /usr/local/bin/subl

export XDEBUG_SESSION=VSCODIUM


alias jiralist='jira issue list  -s "Approved to Deploy" -s "Waiting on Client" -s "New" -s "Implementing" -s "Investigation" -s "Estimating (Product Manager)" -s "Clarification and Scoping" -s "Scheduled for Implementation" -s "Estimating (Technical)" -s "Awaiting Queueing" -s "UAT (Client)" -s "QA (Doghouse)" -s "Failed QA (Doghouse)" --columns reporter,key,summary,status,assignee,updated  --order-by reporter,updated'

# jira add worklog -i <ISSUE_KEY> -t <TIME_SPENT> -c "<COMMENT>"


GOVCMS_TOKEN='glpat-etMT1VZumyeB6G99u-4T'
#echo "$GOVCMS_TOKEN" | docker login gitlab-registry-production.govcms.amazee.io -u bholman.holman --password-stdin
# docker login gitlab-registry-production.govcms.amazee.io -u bholman.holman
# docker login registry-1.docker.io -u doghousefetch

export NVM_DIR="$HOME/.nvm"
  [ -s "/opt/homebrew/opt/nvm/nvm.sh" ] && \. "/opt/homebrew/opt/nvm/nvm.sh"  # This loads nvm
  [ -s "/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm" ] && \. "/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm"  # This loads nvm bash_completion

eval "$(/Users/$USER/.lando/bin/lando shellenv)"


# RUBY_CFLAGS="-Wno-error=implicit-function-declaration"
#eval "$(fastly --completion-script-zsh)"
# brew services restart ph
#alias php='/usr/local/bin/php'
# /usr/bin/php -> ../../Cellar/php/8.4.1_1/bin/php
#
#export PATH="/usr/local/bin:$PATH"
#brew services start php

typeset -g POWERLEVEL9K_INSTANT_PROMPT=quiet

source $HOMEBREW_PREFIX/share/zsh-autosuggestions/zsh-autosuggestions.zsh
source $HOMEBREW_PREFIX/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
